#!/usr/bin/env python3
"""
Build and deploy documentation to GitHub Pages.
"""
import subprocess
import sys
from pathlib import Path


def run_command(cmd, check=True):
    """Run a shell command."""
    print(f"Running: {' '.join(cmd)}")
    result = subprocess.run(cmd, check=check)
    return result


def main():
    # Get project root directory (parent of bin/)
    project_root = Path(__file__).parent.parent
    build_script = Path(__file__).parent / "build"
    
    try:
        # Step 1: Build documentation
        print("\nğŸ”¨ Building documentation...")
        run_command([sys.executable, str(build_script)])
        
        # Step 2: Git add
        print("\nğŸ“ Staging changes...")
        subprocess.run(["git", "add", "-A"], cwd=project_root, check=False)
        
        # Step 3: Git commit
        print("\nğŸ’¾ Committing changes...")
        result = subprocess.run(
            ["git", "commit", "-m", "Build and update documentation"],
            cwd=project_root,
            check=False
        )
        
        if result.returncode != 0:
            print("âš ï¸  No changes to commit")
            return 0
        
        # Step 4: Git push
        print("\nğŸš€ Pushing to GitHub...")
        subprocess.run(["git", "push"], cwd=project_root, check=True)
        
        print("\nâœ… Deployment complete! GitHub Pages will update shortly.")
        return 0
        
    except subprocess.CalledProcessError as e:
        print(f"\nâŒ Error: Command failed with exit code {e.returncode}", file=sys.stderr)
        return 1
    except KeyboardInterrupt:
        print("\nâš ï¸  Deployment interrupted by user", file=sys.stderr)
        return 130
    except Exception as e:
        print(f"\nâŒ Unexpected error: {e}", file=sys.stderr)
        return 1


if __name__ == "__main__":
    sys.exit(main())

